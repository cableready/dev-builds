{"version":3,"file":"cable_ready.umd.min.js","sources":["../javascript/enums.js","../javascript/active_element.js","../javascript/utils.js","../javascript/plugins.js","../javascript/morph_callbacks.js","../javascript/operations.js","../javascript/operation_store.js","../javascript/missing_element.js","../javascript/cable_ready.js","../javascript/elements/cable_ready_element.js","../javascript/elements/subscribing_element.js","../javascript/cable_consumer.js","../javascript/elements/stream_from_element.js","../javascript/elements/updates_for_element.js","../javascript/updatable/inner_updates_compat.js","../javascript/elements/index.js","../javascript/index.js"],"sourcesContent":["export const inputTags = {\n  INPUT: true,\n  TEXTAREA: true,\n  SELECT: true\n}\n\nexport const mutableTags = {\n  INPUT: true,\n  TEXTAREA: true,\n  OPTION: true\n}\n\nexport const textInputTypes = {\n  'datetime-local': true,\n  'select-multiple': true,\n  'select-one': true,\n  color: true,\n  date: true,\n  datetime: true,\n  email: true,\n  month: true,\n  number: true,\n  password: true,\n  range: true,\n  search: true,\n  tel: true,\n  text: true,\n  textarea: true,\n  time: true,\n  url: true,\n  week: true\n}\n","let activeElement\n\nexport default {\n  get element () {\n    return activeElement\n  },\n  set (element) {\n    activeElement = element\n  }\n}\n","import { inputTags, textInputTypes } from './enums'\nimport ActiveElement from './active_element'\n\n// Indicates if the passed element is considered a text input.\n//\nconst isTextInput = element => {\n  return inputTags[element.tagName] && textInputTypes[element.type]\n}\n\n// Assigns focus to the appropriate element... preferring the explicitly passed selector\n//\n// * selector - a CSS selector for the element that should have focus\n//\nconst assignFocus = selector => {\n  const element =\n    selector && selector.nodeType === Node.ELEMENT_NODE\n      ? selector\n      : document.querySelector(selector)\n  const focusElement = element || ActiveElement.element\n  if (focusElement && focusElement.focus) focusElement.focus()\n}\n\n// Dispatches an event on the passed element\n//\n// * element - the element\n// * name - the name of the event\n// * detail - the event detail\n//\nconst dispatch = (element, name, detail = {}) => {\n  const init = { bubbles: true, cancelable: true, detail }\n  const event = new CustomEvent(name, init)\n  element.dispatchEvent(event)\n  if (window.jQuery) window.jQuery(element).trigger(name, detail)\n}\n\n// Accepts an xPath query and returns the element found at that position in the DOM\n//\nconst xpathToElement = xpath => {\n  return document.evaluate(\n    xpath,\n    document,\n    null,\n    XPathResult.FIRST_ORDERED_NODE_TYPE,\n    null\n  ).singleNodeValue\n}\n\n// Accepts an xPath query and returns all matching elements in the DOM\n//\nconst xpathToElementArray = (xpath, reverse = false) => {\n  const snapshotList = document.evaluate(\n    xpath,\n    document,\n    null,\n    XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,\n    null\n  )\n  const snapshots = []\n\n  for (let i = 0; i < snapshotList.snapshotLength; i++) {\n    snapshots.push(snapshotList.snapshotItem(i))\n  }\n\n  return reverse ? snapshots.reverse() : snapshots\n}\n\n// Return an array with the class names to be used\n//\n// * names - could be a string or an array of strings for multiple classes.\n//\nconst getClassNames = names => Array.from(names).flat()\n\n// Perform operation for either the first or all of the elements returned by CSS selector\n//\n// * operation - the instruction payload from perform\n// * callback - the operation function to run for each element\n//\nconst processElements = (operation, callback) => {\n  Array.from(\n    operation.selectAll ? operation.element : [operation.element]\n  ).forEach(callback)\n}\n\n// convert string to kebab-case\n// most other implementations (lodash) are focused on camelCase to kebab-case\n// instead, this uses word token boundaries to produce readable URL slugs and keys\n// this implementation will not support Emoji or other non-ASCII characters\n//\nconst kebabize = createCompounder(function (result, word, index) {\n  return result + (index ? '-' : '') + word.toLowerCase()\n})\n\nfunction createCompounder (callback) {\n  return function (str) {\n    return words(str).reduce(callback, '')\n  }\n}\n\nconst words = str => {\n  str = str == null ? '' : str\n  return str.match(/([A-Z]{2,}|[0-9]+|[A-Z]?[a-z]+|[A-Z])/g) || []\n}\n\n// Provide a standardized pipeline of checks and modifications to all operations based on provided options\n// Currently skips execution if cancelled and implements an optional delay\n//\nconst operate = (operation, callback) => {\n  if (!operation.cancel) {\n    operation.delay ? setTimeout(callback, operation.delay) : callback()\n    return true\n  }\n  return false\n}\n\n// Dispatch life-cycle events with standardized naming\nconst before = (target, operation) =>\n  dispatch(\n    target,\n    `cable-ready:before-${kebabize(operation.operation)}`,\n    operation\n  )\n\nconst after = (target, operation) =>\n  dispatch(\n    target,\n    `cable-ready:after-${kebabize(operation.operation)}`,\n    operation\n  )\n\nfunction debounce (fn, delay = 250) {\n  let timer\n  return (...args) => {\n    const callback = () => fn.apply(this, args)\n    if (timer) clearTimeout(timer)\n    timer = setTimeout(callback, delay)\n  }\n}\n\nfunction handleErrors (response) {\n  if (!response.ok) throw Error(response.statusText)\n  return response\n}\n\nfunction safeScalar (val) {\n  if (\n    val !== undefined &&\n    !['string', 'number', 'boolean'].includes(typeof val)\n  )\n    console.warn(\n      `Operation expects a string, number or boolean, but got ${val} (${typeof val})`\n    )\n  return val != null ? val : ''\n}\n\nfunction safeString (str) {\n  if (str !== undefined && typeof str !== 'string')\n    console.warn(`Operation expects a string, but got ${str} (${typeof str})`)\n\n  return str != null ? String(str) : ''\n}\n\nfunction safeArray (arr) {\n  if (arr !== undefined && !Array.isArray(arr))\n    console.warn(`Operation expects an array, but got ${arr} (${typeof arr})`)\n  return arr != null ? Array.from(arr) : []\n}\n\nfunction safeObject (obj) {\n  if (obj !== undefined && typeof obj !== 'object')\n    console.warn(`Operation expects an object, but got ${obj} (${typeof obj})`)\n  return obj != null ? Object(obj) : {}\n}\n\nfunction safeStringOrArray (elem) {\n  if (elem !== undefined && !Array.isArray(elem) && typeof elem !== 'string')\n    console.warn(`Operation expects an Array or a String, but got ${elem} (${typeof elem})`)\n\n  return elem == null ? '' : Array.isArray(elem) ? Array.from(elem) : String(elem)\n}\n\nfunction fragmentToString (fragment) {\n  return new XMLSerializer().serializeToString(fragment)\n}\n\n// A proxy method to wrap a fetch call in error handling\n//\n// * url - the URL to fetch\n// * additionalHeaders - an object of additional headers passed to fetch\n//\nasync function graciouslyFetch (url, additionalHeaders) {\n  try {\n    const response = await fetch(url, {\n      headers: {\n        'X-REQUESTED-WITH': 'XmlHttpRequest',\n        ...additionalHeaders\n      }\n    })\n    if (response == undefined) return\n\n    handleErrors(response)\n\n    return response\n  } catch (e) {\n    console.error(`Could not fetch ${url}`)\n  }\n}\n\nexport {\n  isTextInput,\n  assignFocus,\n  dispatch,\n  xpathToElement,\n  xpathToElementArray,\n  getClassNames,\n  processElements,\n  operate,\n  before,\n  after,\n  debounce,\n  handleErrors,\n  graciouslyFetch,\n  kebabize,\n  safeScalar,\n  safeString,\n  safeArray,\n  safeObject,\n  safeStringOrArray,\n  fragmentToString\n}\n","const plugins = {}\n\nconst pluginStore = new Proxy(plugins, {\n  get: (target, name) => {\n    return name in target\n      ? target[name]\n      : () => {\n          console.error(\n            `CableReady: No plugin registered for ${name}. Make sure to call CableReady.registerPlugin during initialization. For example:\\n\\nimport CableReady from 'cable_ready'\\nimport ${name} from '${name}'\\nCableReady.registerPlugin('${name}', ${name})`\n          )\n        }\n  }\n})\n\nconst register = (plugin, func) => {\n  plugins[plugin] = func\n}\n\nexport { register }\nexport default pluginStore\n","import { mutableTags } from './enums'\nimport { isTextInput } from './utils'\nimport ActiveElement from './active_element'\n\n// Indicates whether or not we should morph an element via onBeforeElUpdated callback\n// SEE: https://github.com/patrick-steele-idem/morphdom#morphdomfromnode-tonode-options--node\n//\nconst shouldMorph = operation => (fromEl, toEl) => {\n  return !shouldMorphCallbacks\n    .map(callback => {\n      return typeof callback === 'function'\n        ? callback(operation, fromEl, toEl)\n        : true\n    })\n    .includes(false)\n}\n\n// Execute any pluggable functions that modify elements after morphing via onElUpdated callback\n//\nconst didMorph = operation => el => {\n  didMorphCallbacks.forEach(callback => {\n    if (typeof callback === 'function') callback(operation, el)\n  })\n}\n\nconst verifyNotMutable = (detail, fromEl, toEl) => {\n  // Skip nodes that are equal:\n  // https://github.com/patrick-steele-idem/morphdom#can-i-make-morphdom-blaze-through-the-dom-tree-even-faster-yes\n  if (!mutableTags[fromEl.tagName] && fromEl.isEqualNode(toEl)) return false\n  return true\n}\n\nconst verifyNotContentEditable = (detail, fromEl, toEl) => {\n  if (fromEl === ActiveElement.element && fromEl.isContentEditable) return false\n  return true\n}\n\nconst verifyNotPermanent = (detail, fromEl, toEl) => {\n  const { permanentAttributeName } = detail\n  if (!permanentAttributeName) return true\n\n  const permanent = fromEl.closest(`[${permanentAttributeName}]`)\n\n  // only morph attributes on the active non-permanent text input\n  if (!permanent && fromEl === ActiveElement.element && isTextInput(fromEl)) {\n    const ignore = { value: true }\n    Array.from(toEl.attributes).forEach(attribute => {\n      if (!ignore[attribute.name])\n        fromEl.setAttribute(attribute.name, attribute.value)\n    })\n    return false\n  }\n\n  return !permanent\n}\n\nconst shouldMorphCallbacks = [\n  verifyNotMutable,\n  verifyNotPermanent,\n  verifyNotContentEditable\n]\nconst didMorphCallbacks = []\n\nexport {\n  shouldMorphCallbacks,\n  didMorphCallbacks,\n  shouldMorph,\n  didMorph,\n  verifyNotMutable,\n  verifyNotContentEditable,\n  verifyNotPermanent\n}\n","import Plugins from './plugins'\nimport { shouldMorph, didMorph } from './morph_callbacks'\nimport {\n  assignFocus,\n  dispatch,\n  getClassNames,\n  processElements,\n  before,\n  after,\n  operate,\n  safeScalar,\n  safeString,\n  safeArray,\n  safeObject,\n  safeStringOrArray\n} from './utils'\n\nexport default {\n  // DOM Mutations\n\n  append: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.insertAdjacentHTML('beforeend', safeScalar(html))\n        assignFocus(focusSelector)\n      })\n      after(element, operation)\n    })\n  },\n\n  graft: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { parent, focusSelector } = operation\n        const parentElement = document.querySelector(parent)\n        if (parentElement) {\n          parentElement.appendChild(element)\n          assignFocus(focusSelector)\n        }\n      })\n      after(element, operation)\n    })\n  },\n\n  innerHtml: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.innerHTML = safeScalar(html)\n        assignFocus(focusSelector)\n      })\n      after(element, operation)\n    })\n  },\n\n  insertAdjacentHtml: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { html, position, focusSelector } = operation\n        element.insertAdjacentHTML(position || 'beforeend', safeScalar(html))\n        assignFocus(focusSelector)\n      })\n      after(element, operation)\n    })\n  },\n\n  insertAdjacentText: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { text, position, focusSelector } = operation\n        element.insertAdjacentText(position || 'beforeend', safeScalar(text))\n        assignFocus(focusSelector)\n      })\n      after(element, operation)\n    })\n  },\n\n  outerHtml: operation => {\n    processElements(operation, element => {\n      const parent = element.parentElement\n      const idx = parent && Array.from(parent.children).indexOf(element)\n      before(element, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.outerHTML = safeScalar(html)\n        assignFocus(focusSelector)\n      })\n      after(parent ? parent.children[idx] : document.documentElement, operation)\n    })\n  },\n\n  prepend: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.insertAdjacentHTML('afterbegin', safeScalar(html))\n        assignFocus(focusSelector)\n      })\n      after(element, operation)\n    })\n  },\n\n  remove: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { focusSelector } = operation\n        element.remove()\n        assignFocus(focusSelector)\n      })\n      after(document, operation)\n    })\n  },\n\n  replace: operation => {\n    processElements(operation, element => {\n      const parent = element.parentElement\n      const idx = parent && Array.from(parent.children).indexOf(element)\n      before(element, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.outerHTML = safeScalar(html)\n        assignFocus(focusSelector)\n      })\n      after(parent ? parent.children[idx] : document.documentElement, operation)\n    })\n  },\n\n  textContent: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { text, focusSelector } = operation\n        element.textContent = safeScalar(text)\n        assignFocus(focusSelector)\n      })\n      after(element, operation)\n    })\n  },\n\n  // Element Property Mutations\n\n  addCssClass: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { name } = operation\n        element.classList.add(...getClassNames([safeStringOrArray(name)]))\n      })\n      after(element, operation)\n    })\n  },\n\n  removeAttribute: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { name } = operation\n        element.removeAttribute(safeString(name))\n      })\n      after(element, operation)\n    })\n  },\n\n  removeCssClass: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { name } = operation\n        element.classList.remove(...getClassNames([safeStringOrArray(name)]))\n        if (element.classList.length === 0) element.removeAttribute('class')\n      })\n      after(element, operation)\n    })\n  },\n\n  setAttribute: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { name, value } = operation\n        element.setAttribute(safeString(name), safeScalar(value))\n      })\n      after(element, operation)\n    })\n  },\n\n  setDatasetProperty: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { name, value } = operation\n        element.dataset[safeString(name)] = safeScalar(value)\n      })\n      after(element, operation)\n    })\n  },\n\n  setProperty: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { name, value } = operation\n        if (name in element) element[safeString(name)] = safeScalar(value)\n      })\n      after(element, operation)\n    })\n  },\n\n  setStyle: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { name, value } = operation\n        element.style[safeString(name)] = safeScalar(value)\n      })\n      after(element, operation)\n    })\n  },\n\n  setStyles: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { styles } = operation\n        for (let [name, value] of Object.entries(styles))\n          element.style[safeString(name)] = safeScalar(value)\n      })\n      after(element, operation)\n    })\n  },\n\n  setValue: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { value } = operation\n        element.value = safeScalar(value)\n      })\n      after(element, operation)\n    })\n  },\n\n  // DOM Events and Meta-Operations\n\n  dispatchEvent: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        const { name, detail } = operation\n        dispatch(element, safeString(name), safeObject(detail))\n      })\n      after(element, operation)\n    })\n  },\n\n  invokeMethod: operation => {\n    processElements(operation, element => {\n      before(element, operation)\n      operate(operation, () => {\n        let firstObjectInChain\n        const { element, receiver, method, args } = operation\n        const chain = safeString(method).split('.')\n\n        switch (receiver) {\n          case 'window':\n            firstObjectInChain = window\n            break\n          case 'document':\n            firstObjectInChain = document\n            break\n          default:\n            firstObjectInChain = element\n        }\n        let lastObjectInChain = firstObjectInChain\n        const foundMethod = chain.reduce((lastTerm, nextTerm) => {\n          lastObjectInChain = lastTerm\n          return lastTerm[nextTerm] || {}\n        }, firstObjectInChain)\n\n        if (foundMethod instanceof Function) {\n          foundMethod.apply(lastObjectInChain, args || [])\n        } else {\n          console.warn(\n            `CableReady invoke_method operation failed due to missing '${method}' method for:`,\n            firstObjectInChain\n          )\n        }\n      })\n      after(element, operation)\n    })\n  },\n\n  setMeta: operation => {\n    before(document, operation)\n    operate(operation, () => {\n      const { name, content } = operation\n      let meta = document.head.querySelector(`meta[name='${name}']`)\n      if (!meta) {\n        meta = document.createElement('meta')\n        meta.name = safeString(name)\n        document.head.appendChild(meta)\n      }\n      meta.content = safeScalar(content)\n    })\n    after(document, operation)\n  },\n\n  setTitle: operation => {\n    before(document, operation)\n    operate(operation, () => {\n      const { title } = operation\n      document.title = safeScalar(title)\n    })\n    after(document, operation)\n  },\n\n  // Browser Manipulations\n\n  clearStorage: operation => {\n    before(document, operation)\n    operate(operation, () => {\n      const { type } = operation\n      const storage = type === 'session' ? sessionStorage : localStorage\n      storage.clear()\n    })\n    after(document, operation)\n  },\n\n  go: operation => {\n    before(window, operation)\n    operate(operation, () => {\n      const { delta } = operation\n      history.go(delta)\n    })\n    after(window, operation)\n  },\n\n  pushState: operation => {\n    before(window, operation)\n    operate(operation, () => {\n      const { state, title, url } = operation\n      history.pushState(safeObject(state), safeString(title), safeString(url))\n    })\n    after(window, operation)\n  },\n\n  redirectTo: operation => {\n    before(window, operation)\n    operate(operation, () => {\n      let { url, action, turbo } = operation\n      action = action || 'advance'\n      url = safeString(url)\n      if (turbo === undefined) turbo = true\n\n      if (turbo) {\n        if (window.Turbo) window.Turbo.visit(url, { action })\n        if (window.Turbolinks) window.Turbolinks.visit(url, { action })\n        if (!window.Turbo && !window.Turbolinks) window.location.href = url\n      } else {\n        window.location.href = url\n      }\n    })\n    after(window, operation)\n  },\n\n  reload: operation => {\n    before(window, operation)\n    operate(operation, () => {\n      window.location.reload()\n    })\n    after(window, operation)\n  },\n\n  removeStorageItem: operation => {\n    before(document, operation)\n    operate(operation, () => {\n      const { key, type } = operation\n      const storage = type === 'session' ? sessionStorage : localStorage\n      storage.removeItem(safeString(key))\n    })\n    after(document, operation)\n  },\n\n  replaceState: operation => {\n    before(window, operation)\n    operate(operation, () => {\n      const { state, title, url } = operation\n      history.replaceState(\n        safeObject(state),\n        safeString(title),\n        safeString(url)\n      )\n    })\n    after(window, operation)\n  },\n\n  scrollIntoView: operation => {\n    const { element } = operation\n    before(element, operation)\n    operate(operation, () => {\n      element.scrollIntoView(operation)\n    })\n    after(element, operation)\n  },\n\n  setCookie: operation => {\n    before(document, operation)\n    operate(operation, () => {\n      const { cookie } = operation\n      document.cookie = safeScalar(cookie)\n    })\n    after(document, operation)\n  },\n\n  setFocus: operation => {\n    const { element } = operation\n    before(element, operation)\n    operate(operation, () => {\n      assignFocus(element)\n    })\n    after(element, operation)\n  },\n\n  setStorageItem: operation => {\n    before(document, operation)\n    operate(operation, () => {\n      const { key, value, type } = operation\n      const storage = type === 'session' ? sessionStorage : localStorage\n      storage.setItem(safeString(key), safeScalar(value))\n    })\n    after(document, operation)\n  },\n\n  // Notifications\n\n  consoleLog: operation => {\n    before(document, operation)\n    operate(operation, () => {\n      const { message, level } = operation\n      level && ['warn', 'info', 'error'].includes(level)\n        ? console[level](message)\n        : console.log(message)\n    })\n    after(document, operation)\n  },\n\n  consoleTable: operation => {\n    before(document, operation)\n    operate(operation, () => {\n      const { data, columns } = operation\n      console.table(data, safeArray(columns))\n    })\n    after(document, operation)\n  },\n\n  notification: operation => {\n    before(document, operation)\n    operate(operation, () => {\n      const { title, options } = operation\n      Notification.requestPermission().then(result => {\n        operation.permission = result\n        if (result === 'granted')\n          new Notification(safeString(title), safeObject(options))\n      })\n    })\n    after(document, operation)\n  },\n\n  // Morph operations\n\n  morph: operation => {\n    // TODO: remove this in 6.0\n    processElements(operation, element => {\n      const { html } = operation\n      const template = document.createElement('template')\n      template.innerHTML = String(safeScalar(html)).trim()\n      operation.content = template.content\n      const parent = element.parentElement\n      const idx = parent && Array.from(parent.children).indexOf(element)\n      before(element, operation)\n      operate(operation, () => {\n        const { childrenOnly, focusSelector } = operation\n        Plugins.morphdom(\n          element,\n          childrenOnly ? template.content : template.innerHTML,\n          {\n            childrenOnly: !!childrenOnly,\n            onBeforeElUpdated: shouldMorph(operation),\n            onElUpdated: didMorph(operation)\n          }\n        )\n        assignFocus(focusSelector)\n      })\n      console.warn(\n        'The \"morph\" operation is deprecated in CableReady v5 and will be removed in v6. Use \"morphdom\" or similar instead.'\n      )\n      after(parent ? parent.children[idx] : document.documentElement, operation)\n    })\n  },\n\n  morphdom: operation => {\n    processElements(operation, element => {\n      const { html } = operation\n      const template = document.createElement('template')\n      template.innerHTML = String(safeScalar(html)).trim()\n      operation.content = template.content\n      const parent = element.parentElement\n      const idx = parent && Array.from(parent.children).indexOf(element)\n      before(element, operation)\n      operate(operation, () => {\n        const { childrenOnly, focusSelector } = operation\n        Plugins.morphdom(\n          element,\n          childrenOnly ? template.content : template.innerHTML,\n          {\n            childrenOnly: !!childrenOnly,\n            onBeforeElUpdated: shouldMorph(operation),\n            onElUpdated: didMorph(operation)\n          }\n        )\n        assignFocus(focusSelector)\n      })\n      after(parent ? parent.children[idx] : document.documentElement, operation)\n    })\n  }\n}\n","import Operations from './operations'\n\nlet operations = Operations\n\nconst add = newOperations => {\n  operations = { ...operations, ...newOperations }\n}\n\nconst addOperations = operations => {\n  add(operations)\n}\n\nconst addOperation = (name, operation) => {\n  const operations = {}\n  operations[name] = operation\n\n  add(operations)\n}\n\nexport { addOperation, addOperations }\n\nexport default {\n  get all () {\n    return operations\n  }\n}\n","let missingElement = 'warn'\n\nexport default {\n  get behavior () {\n    return missingElement\n  },\n  set (value) {\n    if (['warn', 'ignore', 'event', 'exception'].includes(value))\n      missingElement = value\n    else\n      console.warn(\"Invalid 'onMissingElement' option. Defaulting to 'warn'.\")\n  }\n}\n","import { xpathToElement, xpathToElementArray, dispatch } from './utils'\nimport ActiveElement from './active_element'\nimport OperationStore from './operation_store'\nimport MissingElement from './missing_element'\n\nconst perform = (\n  operations,\n  options = { onMissingElement: MissingElement.behavior }\n) => {\n  const batches = {}\n  operations.forEach(operation => {\n    if (!!operation.batch)\n      batches[operation.batch] = batches[operation.batch]\n        ? ++batches[operation.batch]\n        : 1\n  })\n  operations.forEach(operation => {\n    const name = operation.operation\n    try {\n      if (operation.selector) {\n        if (operation.xpath) {\n          operation.element = operation.selectAll\n            ? xpathToElementArray(operation.selector)\n            : xpathToElement(operation.selector)\n        } else {\n          operation.element = operation.selectAll\n            ? document.querySelectorAll(operation.selector)\n            : document.querySelector(operation.selector)\n        }\n      } else {\n        operation.element = document\n      }\n      if (operation.element || options.onMissingElement !== 'ignore') {\n        ActiveElement.set(document.activeElement)\n        const cableReadyOperation = OperationStore.all[name]\n\n        if (cableReadyOperation) {\n          cableReadyOperation(operation)\n          if (!!operation.batch && --batches[operation.batch] === 0)\n            dispatch(document, 'cable-ready:batch-complete', {\n              batch: operation.batch\n            })\n        } else {\n          console.error(\n            `CableReady couldn't find the \"${name}\" operation. Make sure you use the camelized form when calling an operation method.`\n          )\n        }\n      }\n    } catch (e) {\n      if (operation.element) {\n        console.error(\n          `CableReady detected an error in ${name || 'operation'}: ${\n            e.message\n          }. If you need to support older browsers make sure you've included the corresponding polyfills. https://docs.stimulusreflex.com/setup#polyfills-for-ie11.`\n        )\n        console.error(e)\n      } else {\n        const warning = `CableReady ${name ||\n          ''} operation failed due to missing DOM element for selector: '${\n          operation.selector\n        }'`\n        switch (options.onMissingElement) {\n          case 'ignore':\n            break\n          case 'event':\n            dispatch(document, 'cable-ready:missing-element', {\n              warning,\n              operation\n            })\n            break\n          case 'exception':\n            throw warning\n          default:\n            console.warn(warning)\n        }\n      }\n    }\n  })\n}\n\nconst performAsync = (\n  operations,\n  options = { onMissingElement: MissingElement.behavior }\n) => {\n  return new Promise((resolve, reject) => {\n    try {\n      resolve(perform(operations, options))\n    } catch (err) {\n      reject(err)\n    }\n  })\n}\n\nexport { perform, performAsync }\n","import { perform } from '../cable_ready'\n\nexport default class CableReadyElement extends HTMLElement {\n  static define () {\n    if (!customElements.get('cable-ready')) {\n      customElements.define('cable-ready', this)\n    }\n  }\n\n  connectedCallback () {\n    setTimeout(() => {\n      try {\n        const operations = JSON.parse(this.scriptElement.textContent)\n        perform(operations)\n      } catch (error) {\n        console.error(error)\n      } finally {\n        try {\n          this.remove()\n        } catch {}\n      }\n    })\n  }\n\n  get scriptElement () {\n    if (\n      this.firstElementChild instanceof HTMLScriptElement &&\n      this.firstElementChild.getAttribute('type') === 'application/json'\n    ) {\n      return this.firstElementChild\n    }\n    throw new Error(\n      'First child element in a `<cable-ready>` tag must be `<script type=\"application/json\">`.'\n    )\n  }\n}\n","export default class SubscribingElement extends HTMLElement {\n  disconnectedCallback () {\n    if (this.channel) this.channel.unsubscribe()\n  }\n\n  createSubscription (consumer, channel, receivedCallback) {\n    this.channel = consumer.subscriptions.create(\n      {\n        channel,\n        identifier: this.identifier\n      },\n      {\n        received: receivedCallback\n      }\n    )\n  }\n\n  get preview () {\n    return (\n      document.documentElement.hasAttribute('data-turbolinks-preview') ||\n      document.documentElement.hasAttribute('data-turbo-preview')\n    )\n  }\n\n  get identifier () {\n    return this.getAttribute('identifier')\n  }\n}\n","let consumer\n\nconst BACKOFF = [25, 50, 75, 100, 200, 250, 500, 800, 1000, 2000]\n\nconst wait = (ms) => new Promise(resolve => setTimeout(resolve, ms))\n\nconst getConsumerWithRetry = async (retry = 0) => {\n  if (consumer) return consumer\n\n  if (retry >= BACKOFF.length) {\n    throw new Error(\"Couldn't obtain a Action Cable consumer within 5s\")\n  }\n\n  await wait(BACKOFF[retry])\n\n  return await getConsumerWithRetry(retry + 1)\n}\n\nexport default {\n  setConsumer (value) {\n    consumer = value\n  },\n\n  get consumer () {\n    return consumer\n  },\n\n  async getConsumer () {\n    return await getConsumerWithRetry()\n  }\n}\n","import { perform } from '../cable_ready'\nimport SubscribingElement from './subscribing_element'\nimport CableConsumer from '../cable_consumer'\nimport MissingElement from '../missing_element'\n\nexport default class StreamFromElement extends SubscribingElement {\n  static define () {\n    if (!customElements.get('stream-from')) {\n      customElements.define('stream-from', this)\n    }\n  }\n\n  async connectedCallback () {\n    if (this.preview) return\n\n    const consumer = await CableConsumer.getConsumer()\n\n    if (consumer) {\n      this.createSubscription(\n        consumer,\n        'CableReady::Stream',\n        this.performOperations.bind(this)\n      )\n    } else {\n      console.error(\n        'The `stream_from` helper cannot connect. You must initialize CableReady with an Action Cable consumer.'\n      )\n    }\n  }\n\n  performOperations (data) {\n    if (data.cableReady)\n      perform(data.operations, { onMissingElement: this.onMissingElement })\n  }\n\n  get onMissingElement () {\n    const value = this.getAttribute('missing') || MissingElement.behavior\n\n    // stream_from does not support raising exceptions on missing elements because there's no way to catch them\n    if (['warn', 'ignore', 'event'].includes(value)) return value\n    else {\n      console.warn(\"Invalid 'missing' attribute. Defaulting to 'warn'.\")\n      return 'warn'\n    }\n  }\n}\n","import Plugins from '../plugins'\nimport SubscribingElement from './subscribing_element'\n\nimport { shouldMorph } from '../morph_callbacks'\nimport { debounce, assignFocus, dispatch, graciouslyFetch } from '../utils'\n\nimport ActiveElement from '../active_element'\nimport CableConsumer from '../cable_consumer'\n\nconst template = `\n<style>\n  :host {\n    display: block;\n  }\n</style>\n<slot></slot>\n`\n\nfunction url (element) {\n  return element.hasAttribute('url')\n    ? element.getAttribute('url')\n    : location.href\n}\n\nexport default class UpdatesForElement extends SubscribingElement {\n  static define () {\n    if (!customElements.get('updates-for')) {\n      customElements.define('updates-for', this)\n    }\n  }\n\n  constructor () {\n    super()\n    const shadowRoot = this.attachShadow({ mode: 'open' })\n    shadowRoot.innerHTML = template\n  }\n\n  async connectedCallback () {\n    if (this.preview) return\n    this.update = debounce(this.update.bind(this), this.debounce)\n\n    const consumer = await CableConsumer.getConsumer()\n\n    if (consumer) {\n      this.createSubscription(consumer, 'CableReady::Stream', this.update)\n    } else {\n      console.error(\n        'The `updates-for` helper cannot connect. You must initialize CableReady with an Action Cable consumer.'\n      )\n    }\n  }\n\n  async update (data) {\n    const blocks = Array.from(\n      document.querySelectorAll(this.query),\n      element => new Block(element)\n    ).filter(block => block.shouldUpdate(data))\n\n    // first updates-for element in the DOM *at any given moment* updates all of the others\n    if (blocks.length === 0 || blocks[0].element !== this) return\n\n    // hold a reference to the active element so that it can be restored after the morph\n    ActiveElement.set(document.activeElement)\n\n    // store all retrieved HTML in an object keyed by URL to minimize fetch calls\n    this.html = {}\n\n    const uniqueUrls = [...new Set(blocks.map(block => block.url))]\n\n    await Promise.all(\n      uniqueUrls.map(async url => {\n        if (!this.html.hasOwnProperty(url)) {\n          const response = await graciouslyFetch(url, {\n            'X-Cable-Ready': 'update'\n          })\n          this.html[url] = await response.text()\n        }\n      })\n    )\n\n    // track current block index for each URL; referred to as fragments\n    this.index = {}\n\n    blocks.forEach(block => {\n      // if the block's URL is not in the index, initialize it to 0; otherwise, increment it\n      this.index.hasOwnProperty(block.url)\n        ? this.index[block.url]++\n        : (this.index[block.url] = 0)\n\n      block.process(data, this.html, this.index)\n    })\n  }\n\n  get query () {\n    return `updates-for[identifier=\"${this.identifier}\"]`\n  }\n\n  get identifier () {\n    return this.getAttribute('identifier')\n  }\n\n  get debounce () {\n    return this.hasAttribute('debounce')\n      ? parseInt(this.getAttribute('debounce'))\n      : 20\n  }\n}\n\nclass Block {\n  constructor (element) {\n    this.element = element\n  }\n\n  async process (data, html, index) {\n    const blockIndex = index[this.url]\n    const template = document.createElement('template')\n    this.element.setAttribute('updating', 'updating')\n\n    template.innerHTML = String(html[this.url]).trim()\n\n    await this.resolveTurboFrames(template.content)\n\n    const fragments = template.content.querySelectorAll(this.query)\n\n    if (fragments.length <= blockIndex) {\n      console.warn(\n        `Update aborted due to insufficient number of elements. The offending url is ${this.url}.`\n      )\n      return\n    }\n\n    const operation = {\n      element: this.element,\n      html: fragments[blockIndex],\n      permanentAttributeName: 'data-ignore-updates'\n    }\n\n    dispatch(this.element, 'cable-ready:before-update', operation)\n    Plugins.morphdom(this.element, fragments[blockIndex], {\n      childrenOnly: true,\n      onBeforeElUpdated: shouldMorph(operation),\n      onElUpdated: _ => {\n        this.element.removeAttribute('updating')\n        dispatch(this.element, 'cable-ready:after-update', operation)\n        assignFocus(operation.focusSelector)\n      }\n    })\n  }\n\n  async resolveTurboFrames (docFragment) {\n    const reloadingTurboFrames = [\n      ...docFragment.querySelectorAll('turbo-frame[src]:not([loading=\"lazy\"])')\n    ]\n\n    return Promise.all(\n      reloadingTurboFrames.map(frame => {\n        return new Promise(async resolve => {\n          const frameResponse = await graciouslyFetch(\n            frame.getAttribute('src'),\n            {\n              'Turbo-Frame': frame.id,\n              'X-Cable-Ready': 'update'\n            }\n          )\n\n          const frameTemplate = document.createElement('template')\n          frameTemplate.innerHTML = await frameResponse.text()\n\n          // recurse here to get all nested eager loaded frames\n          await this.resolveTurboFrames(frameTemplate.content)\n\n          const selector = `turbo-frame#${frame.id}`\n          const frameContent = frameTemplate.content.querySelector(selector)\n          const content = frameContent ? frameContent.innerHTML.trim() : ''\n\n          docFragment.querySelector(selector).innerHTML = content\n\n          resolve()\n        })\n      })\n    )\n  }\n\n  shouldUpdate (data) {\n    // if everything that could prevent an update is false, update this block\n    return !this.ignoresInnerUpdates && this.hasChangesSelectedForUpdate(data)\n  }\n\n  hasChangesSelectedForUpdate (data) {\n    // if there's an only attribute, only update if at least one of the attributes changed is in the allow list\n    const only = this.element.getAttribute('only')\n\n    return !(\n      only &&\n      data.changed &&\n      !only.split(' ').some(attribute => data.changed.includes(attribute))\n    )\n  }\n\n  get ignoresInnerUpdates () {\n    // don't update during a Reflex or Turbolinks redraw\n    return (\n      this.element.hasAttribute('ignore-inner-updates') &&\n      this.element.hasAttribute('performing-inner-update')\n    )\n  }\n\n  get url () {\n    return this.element.hasAttribute('url')\n      ? this.element.getAttribute('url')\n      : location.href\n  }\n\n  get identifier () {\n    return this.element.identifier\n  }\n\n  get query () {\n    return this.element.query\n  }\n}\n","export const registerInnerUpdates = () => {\n  document.addEventListener('stimulus-reflex:before', event => {\n    recursiveMarkUpdatesForElements(event.detail.element)\n  })\n\n  document.addEventListener('stimulus-reflex:after', event => {\n    setTimeout(() => {\n      recursiveUnmarkUpdatesForElements(event.detail.element)\n    })\n  })\n\n  document.addEventListener('turbo:submit-start', event => {\n    recursiveMarkUpdatesForElements(event.target)\n  })\n\n  document.addEventListener('turbo:submit-end', event => {\n    setTimeout(() => {\n      recursiveUnmarkUpdatesForElements(event.target)\n    })\n  })\n}\n\nconst recursiveMarkUpdatesForElements = leaf => {\n  const closestUpdatesFor =\n    leaf && leaf.parentElement && leaf.parentElement.closest('updates-for')\n  if (closestUpdatesFor) {\n    closestUpdatesFor.setAttribute('performing-inner-update', '')\n    recursiveMarkUpdatesForElements(closestUpdatesFor)\n  }\n}\n\nconst recursiveUnmarkUpdatesForElements = leaf => {\n  const closestUpdatesFor =\n    leaf && leaf.parentElement && leaf.parentElement.closest('updates-for')\n  if (closestUpdatesFor) {\n    closestUpdatesFor.removeAttribute('performing-inner-update')\n    recursiveUnmarkUpdatesForElements(closestUpdatesFor)\n  }\n}\n","import CableReadyElement from './cable_ready_element'\nimport StreamFromElement from './stream_from_element'\nimport UpdatesForElement from './updates_for_element'\n\nimport { registerInnerUpdates } from '../updatable/inner_updates_compat'\n\nexport const defineElements = () => {\n  registerInnerUpdates()\n\n  CableReadyElement.define()\n  StreamFromElement.define()\n  UpdatesForElement.define()\n}\n","import packageInfo from '../package.json'\nimport { perform, performAsync } from './cable_ready'\nimport { defineElements } from './elements'\nimport { shouldMorphCallbacks, didMorphCallbacks } from './morph_callbacks'\n\nimport * as Plugins from './plugins'\n\n// TODO: Remove this in v6\n// Kicking the can down the road for now\nimport morphdom from 'morphdom'\nPlugins.register('morphdom', morphdom)\n\nimport * as MorphCallbacks from './morph_callbacks'\nimport * as Utils from './utils'\n\nimport OperationStore, { addOperation, addOperations } from './operation_store'\nimport CableReadyElement from './elements/cable_ready_element'\nimport StreamFromElement from './elements/stream_from_element'\nimport UpdatesForElement from './elements/updates_for_element'\nimport SubscribingElement from './elements/subscribing_element'\nimport CableConsumer from './cable_consumer'\n\nconst initialize = (initializeOptions = {}) => {\n  const { consumer, onMissingElement, plugins } = initializeOptions\n\n  if (consumer) {\n    CableConsumer.setConsumer(consumer)\n  } else {\n    console.error(\n      'CableReady requires a reference to your Action Cable `consumer` for its helpers to function.\\nEnsure that you have imported the `CableReady` package as well as `consumer` from your `channels` folder, then call `CableReady.initialize({ consumer })`.'\n    )\n  }\n\n  if (onMissingElement) MissingElement.set(onMissingElement)\n\n  if (plugins)\n    Object.keys(plugins).forEach(plugin =>\n      Plugins.register(plugin, plugins[plugin])\n    )\n\n  defineElements()\n}\n\nexport {\n  Utils,\n  MorphCallbacks,\n  Plugins,\n  CableReadyElement,\n  StreamFromElement,\n  UpdatesForElement,\n  SubscribingElement\n}\n\nconst global = {\n  perform,\n  performAsync,\n  shouldMorphCallbacks,\n  didMorphCallbacks,\n  initialize,\n  registerPlugin: Plugins.register,\n  addOperation,\n  addOperations,\n  version: packageInfo.version,\n  cable: CableConsumer,\n  get DOMOperations () {\n    console.warn(\n      'DEPRECATED: Please use `CableReady.operations` instead of `CableReady.DOMOperations`'\n    )\n    return OperationStore.all\n  },\n  get operations () {\n    return OperationStore.all\n  },\n  get consumer () {\n    return CableConsumer.consumer\n  }\n}\n\nwindow.CableReady = global\n\nexport default global\n"],"names":["inputTags","INPUT","TEXTAREA","SELECT","mutableTags","OPTION","textInputTypes","color","date","datetime","email","month","number","password","range","search","tel","text","textarea","time","url","week","activeElement","ActiveElement","element","set","isTextInput","tagName","type","assignFocus","selector","focusElement","nodeType","Node","ELEMENT_NODE","document","querySelector","focus","dispatch","name","detail","event","CustomEvent","bubbles","cancelable","dispatchEvent","window","jQuery","trigger","xpathToElement","xpath","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","xpathToElementArray","reverse","snapshotList","ORDERED_NODE_SNAPSHOT_TYPE","snapshots","i","snapshotLength","push","snapshotItem","getClassNames","names","Array","from","flat","processElements","operation","callback","selectAll","forEach","kebabize","result","word","index","toLowerCase","str","words","reduce","match","operate","cancel","delay","setTimeout","before","target","after","debounce","fn","timer","args","clearTimeout","apply","this","handleErrors","response","ok","Error","statusText","safeScalar","val","undefined","includes","console","warn","safeString","String","safeArray","arr","isArray","safeObject","obj","Object","safeStringOrArray","elem","async","graciouslyFetch","additionalHeaders","fetch","headers","e","error","fragment","XMLSerializer","serializeToString","plugins","pluginStore","Proxy","get","register","plugin","func","shouldMorph","fromEl","toEl","shouldMorphCallbacks","map","didMorph","el","didMorphCallbacks","verifyNotMutable","isEqualNode","verifyNotContentEditable","isContentEditable","verifyNotPermanent","permanentAttributeName","permanent","closest","ignore","value","attributes","attribute","setAttribute","Operations","append","html","focusSelector","insertAdjacentHTML","graft","parent","parentElement","appendChild","innerHtml","innerHTML","insertAdjacentHtml","position","insertAdjacentText","outerHtml","idx","children","indexOf","outerHTML","documentElement","prepend","remove","replace","textContent","addCssClass","classList","add","removeAttribute","removeCssClass","length","setDatasetProperty","dataset","setProperty","setStyle","style","setStyles","styles","entries","setValue","invokeMethod","firstObjectInChain","receiver","method","chain","split","lastObjectInChain","foundMethod","lastTerm","nextTerm","Function","setMeta","content","meta","head","createElement","setTitle","title","clearStorage","sessionStorage","localStorage","clear","go","delta","history","pushState","state","redirectTo","action","turbo","Turbo","visit","Turbolinks","location","href","reload","removeStorageItem","key","removeItem","replaceState","scrollIntoView","setCookie","cookie","setFocus","setStorageItem","setItem","consoleLog","message","level","log","consoleTable","data","columns","table","notification","options","Notification","requestPermission","then","permission","morph","template","trim","childrenOnly","Plugins","morphdom","onBeforeElUpdated","onElUpdated","operations","newOperations","OperationStore","all","missingElement","MissingElement$1","behavior","perform","onMissingElement","MissingElement","batches","batch","querySelectorAll","cableReadyOperation","warning","CableReadyElement","HTMLElement","static","customElements","define","connectedCallback","JSON","parse","scriptElement","firstElementChild","HTMLScriptElement","getAttribute","SubscribingElement","disconnectedCallback","channel","unsubscribe","createSubscription","consumer","receivedCallback","subscriptions","create","identifier","received","preview","hasAttribute","BACKOFF","getConsumerWithRetry","retry","ms","Promise","resolve","CableConsumer","setConsumer","StreamFromElement","getConsumer","performOperations","bind","cableReady","UpdatesForElement","constructor","super","attachShadow","mode","update","blocks","query","Block","filter","block","shouldUpdate","uniqueUrls","Set","hasOwnProperty","process","parseInt","blockIndex","resolveTurboFrames","fragments","_","docFragment","reloadingTurboFrames","frame","frameResponse","id","frameTemplate","frameContent","ignoresInnerUpdates","hasChangesSelectedForUpdate","only","changed","some","recursiveMarkUpdatesForElements","leaf","closestUpdatesFor","recursiveUnmarkUpdatesForElements","defineElements","addEventListener","Plugins.register","global","performAsync","reject","err","initialize","initializeOptions","keys","registerPlugin","addOperation","addOperations","version","packageInfo","cable","DOMOperations","CableReady"],"mappings":"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"}