!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("morphdom")):"function"==typeof define&&define.amd?define(["exports","morphdom"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CableReady={},e.morphdom)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(t),o="5.0.0-pre9";const i={INPUT:!0,TEXTAREA:!0,SELECT:!0},s={INPUT:!0,TEXTAREA:!0,OPTION:!0},a={"datetime-local":!0,"select-multiple":!0,"select-one":!0,color:!0,date:!0,datetime:!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,textarea:!0,time:!0,url:!0,week:!0};let c;var l={get element(){return c},set(e){c=e}};const u=e=>i[e.tagName]&&a[e.type],h=e=>{const t=(e&&e.nodeType===Node.ELEMENT_NODE?e:document.querySelector(e))||l.element;t&&t.focus&&t.focus()},d=(e,t,n={})=>{const r=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e.dispatchEvent(r),window.jQuery&&window.jQuery(e).trigger(t,n)},f=e=>document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,p=e=>{const t=document.evaluate(e,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),n=[];for(let e=0;e<t.snapshotLength;e++)n.push(t.snapshotItem(e));return n},m=e=>Array.from(e).flat(),y=(e,t)=>{Array.from(e.selectAll?e.element:[e.element]).forEach(t)},b=e=>e.split("").map(((e,t)=>e.toUpperCase()===e?`${0!==t?"-":""}${e.toLowerCase()}`:e)).join(""),g=(e,t)=>!e.cancel&&(e.delay?setTimeout(t,e.delay):t(),!0),w=(e,t)=>d(e,`cable-ready:before-${b(t.operation)}`,t),v=(e,t)=>d(e,`cable-ready:after-${b(t.operation)}`,t);function E(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>e.apply(this,r)),t)}}function x(e){if(!e.ok)throw Error(e.statusText);return e}function S(e){return void 0===e||["string","number","boolean"].includes(typeof e)||console.warn(`Operation expects a string, number or boolean, but got ${e} (${typeof e})`),null!=e?e:""}function A(e){return void 0!==e&&"string"!=typeof e&&console.warn(`Operation expects a string, but got ${e} (${typeof e})`),null!=e?String(e):""}function T(e){return void 0===e||Array.isArray(e)||console.warn(`Operation expects an array, but got ${e} (${typeof e})`),null!=e?Array.from(e):[]}function U(e){return void 0!==e&&"object"!=typeof e&&console.warn(`Operation expects an object, but got ${e} (${typeof e})`),null!=e?Object(e):{}}async function C(e,t){try{const n=await fetch(e,{headers:{"X-REQUESTED-WITH":"XmlHttpRequest",...t}});if(null==n)return;return x(n),n}catch(t){console.error(`Could not fetch ${e}`)}}var L=Object.freeze({__proto__:null,isTextInput:u,assignFocus:h,dispatch:d,xpathToElement:f,xpathToElementArray:p,getClassNames:m,processElements:y,operate:g,before:w,after:v,debounce:E,handleErrors:x,graciouslyFetch:C,kebabize:b,safeScalar:S,safeString:A,safeArray:T,safeObject:U});const k=e=>(t,n)=>!P.map((r=>"function"!=typeof r||r(e,t,n))).includes(!1),M=e=>t=>{B.forEach((n=>{"function"==typeof n&&n(e,t)}))},I=(e,t,n)=>!(!s[t.tagName]&&t.isEqualNode(n)),O=(e,t,n)=>t!==l.element||!t.isContentEditable,_=(e,t,n)=>{const{permanentAttributeName:r}=e;if(!r)return!0;const o=t.closest(`[${r}]`);if(!o&&t===l.element&&u(t)){const e={value:!0};return Array.from(n.attributes).forEach((n=>{e[n.name]||t.setAttribute(n.name,n.value)})),!1}return!o},P=[I,_,O],B=[];var D=Object.freeze({__proto__:null,shouldMorphCallbacks:P,didMorphCallbacks:B,shouldMorph:k,didMorph:M,verifyNotMutable:I,verifyNotContentEditable:O,verifyNotPermanent:_}),R={append:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{html:n,focusSelector:r}=e;t.insertAdjacentHTML("beforeend",S(n)),h(r)})),v(t,e)}))},graft:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{parent:n,focusSelector:r}=e,o=document.querySelector(n);o&&(o.appendChild(t),h(r))})),v(t,e)}))},innerHtml:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{html:n,focusSelector:r}=e;t.innerHTML=S(n),h(r)})),v(t,e)}))},insertAdjacentHtml:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{html:n,position:r,focusSelector:o}=e;t.insertAdjacentHTML(r||"beforeend",S(n)),h(o)})),v(t,e)}))},insertAdjacentText:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{text:n,position:r,focusSelector:o}=e;t.insertAdjacentText(r||"beforeend",S(n)),h(o)})),v(t,e)}))},morph:e=>{y(e,(t=>{const{html:n}=e,o=document.createElement("template");o.innerHTML=String(S(n)).trim(),e.content=o.content;const i=t.parentElement,s=Array.from(i.children).indexOf(t);w(t,e),g(e,(()=>{const{childrenOnly:n,focusSelector:i}=e;r.default(t,n?o.content:o.innerHTML,{childrenOnly:!!n,onBeforeElUpdated:k(e),onElUpdated:M(e)}),h(i)})),v(i.children[s],e)}))},outerHtml:e=>{y(e,(t=>{const n=t.parentElement,r=Array.from(n.children).indexOf(t);w(t,e),g(e,(()=>{const{html:n,focusSelector:r}=e;t.outerHTML=S(n),h(r)})),v(n.children[r],e)}))},prepend:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{html:n,focusSelector:r}=e;t.insertAdjacentHTML("afterbegin",S(n)),h(r)})),v(t,e)}))},remove:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{focusSelector:n}=e;t.remove(),h(n)})),v(document,e)}))},replace:e=>{y(e,(t=>{const n=t.parentElement,r=Array.from(n.children).indexOf(t);w(t,e),g(e,(()=>{const{html:n,focusSelector:r}=e;t.outerHTML=S(n),h(r)})),v(n.children[r],e)}))},textContent:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{text:n,focusSelector:r}=e;t.textContent=S(n),h(r)})),v(t,e)}))},addCssClass:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{name:n}=e;t.classList.add(...m([A(n)]))})),v(t,e)}))},removeAttribute:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{name:n}=e;t.removeAttribute(A(n))})),v(t,e)}))},removeCssClass:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{name:n}=e;t.classList.remove(...m([A(n)]))})),v(t,e)}))},setAttribute:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{name:n,value:r}=e;t.setAttribute(A(n),S(r))})),v(t,e)}))},setDatasetProperty:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{name:n,value:r}=e;t.dataset[A(n)]=S(r)})),v(t,e)}))},setProperty:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{name:n,value:r}=e;n in t&&(t[A(n)]=S(r))})),v(t,e)}))},setStyle:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{name:n,value:r}=e;t.style[A(n)]=S(r)})),v(t,e)}))},setStyles:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{styles:n}=e;for(let[e,r]of Object.entries(n))t.style[A(e)]=S(r)})),v(t,e)}))},setValue:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{value:n}=e;t.value=S(n)})),v(t,e)}))},dispatchEvent:e=>{y(e,(t=>{w(t,e),g(e,(()=>{const{name:n,detail:r}=e;d(t,A(n),U(r))})),v(t,e)}))},invokeMethod:e=>{y(e,(t=>{w(t,e),g(e,(()=>{let t;const{element:n,receiver:r,method:o,args:i}=e,s=A(o).split(".");switch(r){case"window":t=window;break;case"document":t=document;break;default:t=n}let a=t;const c=s.reduce(((e,t)=>(a=e,e[t]||{})),t);c instanceof Function?c.apply(a,i||[]):console.warn(`CableReady invoke_method operation failed due to missing '${o}' method for:`,t)})),v(t,e)}))},setMeta:e=>{w(document,e),g(e,(()=>{const{name:t,content:n}=e;let r=document.head.querySelector(`meta[name='${t}']`);r||(r=document.createElement("meta"),r.name=A(t),document.head.appendChild(r)),r.content=S(n)})),v(document,e)},clearStorage:e=>{w(document,e),g(e,(()=>{const{type:t}=e;("session"===t?sessionStorage:localStorage).clear()})),v(document,e)},go:e=>{w(window,e),g(e,(()=>{const{delta:t}=e;history.go(t)})),v(window,e)},pushState:e=>{w(window,e),g(e,(()=>{const{state:t,title:n,url:r}=e;history.pushState(U(t),A(n),A(r))})),v(window,e)},redirectTo:e=>{w(window,e),g(e,(()=>{let{url:t,action:n,turbo:r}=e;n=n||"advance",t=A(t),void 0===r&&(r=!0),r?(window.Turbo&&window.Turbo.visit(t,{action:n}),window.Turbolinks&&window.Turbolinks.visit(t,{action:n}),window.Turbo||window.Turbolinks||(window.location.href=t)):window.location.href=t})),v(window,e)},reload:e=>{w(window,e),g(e,(()=>{window.location.reload()})),v(window,e)},removeStorageItem:e=>{w(document,e),g(e,(()=>{const{key:t,type:n}=e;("session"===n?sessionStorage:localStorage).removeItem(A(t))})),v(document,e)},replaceState:e=>{w(window,e),g(e,(()=>{const{state:t,title:n,url:r}=e;history.replaceState(U(t),A(n),A(r))})),v(window,e)},scrollIntoView:e=>{const{element:t}=e;w(t,e),g(e,(()=>{t.scrollIntoView(e)})),v(t,e)},setCookie:e=>{w(document,e),g(e,(()=>{const{cookie:t}=e;document.cookie=S(t)})),v(document,e)},setFocus:e=>{const{element:t}=e;w(t,e),g(e,(()=>{h(t)})),v(t,e)},setStorageItem:e=>{w(document,e),g(e,(()=>{const{key:t,value:n,type:r}=e;("session"===r?sessionStorage:localStorage).setItem(A(t),S(n))})),v(document,e)},consoleLog:e=>{w(document,e),g(e,(()=>{const{message:t,level:n}=e;n&&["warn","info","error"].includes(n)?console[n](t):console.log(t)})),v(document,e)},consoleTable:e=>{w(document,e),g(e,(()=>{const{data:t,columns:n}=e;console.table(t,T(n))})),v(document,e)},notification:e=>{w(document,e),g(e,(()=>{const{title:t,options:n}=e;Notification.requestPermission().then((r=>{e.permission=r,"granted"===r&&new Notification(A(t),U(n))}))})),v(document,e)}};let j=R;const N=e=>{j={...j,...e}};var H,$,F,q={get all(){return j}},z=4294967295;function V(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}var X=("undefined"==typeof process||"never"!==(null===(H=null===process||void 0===process?void 0:process.env)||void 0===H?void 0:H.TEXT_ENCODING))&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder,K=X?new TextEncoder:void 0;X&&"undefined"!=typeof process&&(null===($=null===process||void 0===process?void 0:process.env)||void 0===$||$.TEXT_ENCODING),null==K||K.encodeInto;function W(e,t,n){for(var r=t,o=r+n,i=[],s="";r<o;){var a=e[r++];if(0==(128&a))i.push(a);else if(192==(224&a)){var c=63&e[r++];i.push((31&a)<<6|c)}else if(224==(240&a)){c=63&e[r++];var l=63&e[r++];i.push((31&a)<<12|c<<6|l)}else if(240==(248&a)){var u=(7&a)<<18|(c=63&e[r++])<<12|(l=63&e[r++])<<6|63&e[r++];u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u)}else i.push(a);i.length>=4096&&(s+=String.fromCharCode.apply(String,i),i.length=0)}return i.length>0&&(s+=String.fromCharCode.apply(String,i)),s}var G=X?new TextDecoder:null,Q=X?"undefined"!=typeof process&&"force"!==(null===(F=null===process||void 0===process?void 0:process.env)||void 0===F?void 0:F.TEXT_DECODER)?200:0:z;var Y,J=function(e,t){this.type=e,this.data=t},Z=(Y=function(e,t){return Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Y(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ee=function(e){function t(n){var r=e.call(this,n)||this,o=Object.create(t.prototype);return Object.setPrototypeOf(r,o),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:t.name}),r}return Z(t,e),t}(Error);function te(e){var t=e.sec,n=e.nsec;if(t>=0&&n>=0&&t<=17179869183){if(0===n&&t<=4294967295){var r=new Uint8Array(4);return(s=new DataView(r.buffer)).setUint32(0,t),r}var o=t/4294967296,i=4294967295&t;r=new Uint8Array(8);return(s=new DataView(r.buffer)).setUint32(0,n<<2|3&o),s.setUint32(4,i),r}var s;r=new Uint8Array(12);return(s=new DataView(r.buffer)).setUint32(0,n),function(e,t,n){var r=Math.floor(n/4294967296),o=n;e.setUint32(t,r),e.setUint32(t+4,o)}(s,4,t),r}var ne={type:-1,encode:function(e){var t,n,r,o;return e instanceof Date?te((t=e.getTime(),n=Math.floor(t/1e3),r=1e6*(t-1e3*n),o=Math.floor(r/1e9),{sec:n+o,nsec:r-1e9*o})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:var n=t.getUint32(0);return{sec:4294967296*(3&n)+t.getUint32(4),nsec:n>>>2};case 12:return{sec:V(t,4),nsec:t.getUint32(0)};default:throw new ee("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},re=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(ne)}return e.prototype.register=function(e){var t=e.type,n=e.encode,r=e.decode;if(t>=0)this.encoders[t]=n,this.decoders[t]=r;else{var o=1+t;this.builtInEncoders[o]=n,this.builtInDecoders[o]=r}},e.prototype.tryToEncode=function(e,t){for(var n=0;n<this.builtInEncoders.length;n++){if(null!=(r=this.builtInEncoders[n]))if(null!=(o=r(e,t)))return new J(-1-n,o)}for(n=0;n<this.encoders.length;n++){var r,o;if(null!=(r=this.encoders[n]))if(null!=(o=r(e,t)))return new J(n,o)}return e instanceof J?e:null},e.prototype.decode=function(e,t,n){var r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,n):new J(t,e)},e.defaultCodec=new e,e}();function oe(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}function ie(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}var se=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,n){e:for(var r=0,o=this.caches[n-1];r<o.length;r++){for(var i=o[r],s=i.bytes,a=0;a<n;a++)if(s[a]!==e[t+a])continue e;return i.str}return null},e.prototype.store=function(e,t){var n=this.caches[e.length-1],r={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},e.prototype.decode=function(e,t,n){var r=this.find(e,t,n);if(null!=r)return this.hit++,r;this.miss++;var o=W(e,t,n),i=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(i,o),o},e}(),ae=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},ce=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},le=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}},ue=function(e){return this instanceof ue?(this.v=e,this):new ue(e)},he=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof ue?Promise.resolve(n.value.v).then(c,l):u(i[0][2],n)}catch(e){u(i[0][3],e)}var n}function c(e){a("next",e)}function l(e){a("throw",e)}function u(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}},de=new DataView(new ArrayBuffer(0)),fe=new Uint8Array(de.buffer),pe=function(){try{de.getInt8(0)}catch(e){return e.constructor}throw new Error("never reached")}(),me=new pe("Insufficient data"),ye=new se,be=function(){function e(e,t,n,r,o,i,s,a){void 0===e&&(e=re.defaultCodec),void 0===t&&(t=void 0),void 0===n&&(n=z),void 0===r&&(r=z),void 0===o&&(o=z),void 0===i&&(i=z),void 0===s&&(s=z),void 0===a&&(a=ye),this.extensionCodec=e,this.context=t,this.maxStrLength=n,this.maxBinLength=r,this.maxArrayLength=o,this.maxMapLength=i,this.maxExtLength=s,this.keyDecoder=a,this.totalPos=0,this.pos=0,this.view=de,this.bytes=fe,this.headByte=-1,this.stack=[]}return e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=oe(e),this.view=function(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=oe(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),n=oe(e),r=new Uint8Array(t.length+n.length);r.set(t),r.set(n,t.length),this.setBuffer(r)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,n=this.pos;return new RangeError("Extra ".concat(t.byteLength-n," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return ce(this,(function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return t.sent(),[3,1];case 3:return[2]}}))},e.prototype.decodeAsync=function(e){var t,n,r,o;return ae(this,void 0,void 0,(function(){var i,s,a,c,l,u,h,d;return ce(this,(function(f){switch(f.label){case 0:i=!1,f.label=1;case 1:f.trys.push([1,6,7,12]),t=le(e),f.label=2;case 2:return[4,t.next()];case 3:if((n=f.sent()).done)return[3,5];if(a=n.value,i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{s=this.doDecodeSync(),i=!0}catch(e){if(!(e instanceof pe))throw e}this.totalPos+=this.pos,f.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return c=f.sent(),r={error:c},[3,12];case 7:return f.trys.push([7,,10,11]),n&&!n.done&&(o=t.return)?[4,o.call(t)]:[3,9];case 8:f.sent(),f.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:if(i){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,s]}throw u=(l=this).headByte,h=l.pos,d=l.totalPos,new RangeError("Insufficient data in parsing ".concat(ie(u)," at ").concat(d," (").concat(h," in the current buffer)"))}}))}))},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return he(this,arguments,(function(){var n,r,o,i,s,a,c,l,u;return ce(this,(function(h){switch(h.label){case 0:n=t,r=-1,h.label=1;case 1:h.trys.push([1,13,14,19]),o=le(e),h.label=2;case 2:return[4,ue(o.next())];case 3:if((i=h.sent()).done)return[3,12];if(s=i.value,t&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(r=this.readArraySize(),n=!1,this.complete()),h.label=4;case 4:h.trys.push([4,9,,10]),h.label=5;case 5:return[4,ue(this.doDecodeSync())];case 6:return[4,h.sent()];case 7:return h.sent(),0==--r?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((a=h.sent())instanceof pe))throw a;return[3,10];case 10:this.totalPos+=this.pos,h.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return c=h.sent(),l={error:c},[3,19];case 14:return h.trys.push([14,,17,18]),i&&!i.done&&(u=o.return)?[4,ue(u.call(o))]:[3,16];case 15:h.sent(),h.label=16;case 16:return[3,18];case 17:if(l)throw l.error;return[7];case 18:return[7];case 19:return[2]}}))}))},e.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){if(0!==(r=e-128)){this.pushMapState(r),this.complete();continue e}t={}}else if(e<160){if(0!==(r=e-144)){this.pushArrayState(r),this.complete();continue e}t=[]}else{var n=e-160;t=this.decodeUtf8String(n,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.readI64();else if(217===e){n=this.lookU8();t=this.decodeUtf8String(n,1)}else if(218===e){n=this.lookU16();t=this.decodeUtf8String(n,2)}else if(219===e){n=this.lookU32();t=this.decodeUtf8String(n,4)}else if(220===e){if(0!==(r=this.readU16())){this.pushArrayState(r),this.complete();continue e}t=[]}else if(221===e){if(0!==(r=this.readU32())){this.pushArrayState(r),this.complete();continue e}t=[]}else if(222===e){if(0!==(r=this.readU16())){this.pushMapState(r),this.complete();continue e}t={}}else if(223===e){if(0!==(r=this.readU32())){this.pushMapState(r),this.complete();continue e}t={}}else if(196===e){var r=this.lookU8();t=this.decodeBinary(r,1)}else if(197===e){r=this.lookU16();t=this.decodeBinary(r,2)}else if(198===e){r=this.lookU32();t=this.decodeBinary(r,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){r=this.lookU8();t=this.decodeExtension(r,1)}else if(200===e){r=this.lookU16();t=this.decodeExtension(r,2)}else{if(201!==e)throw new ee("Unrecognized type byte: ".concat(ie(e)));r=this.lookU32();t=this.decodeExtension(r,4)}this.complete();for(var o=this.stack;o.length>0;){var i=o[o.length-1];if(0===i.type){if(i.array[i.position]=t,i.position++,i.position!==i.size)continue e;o.pop(),t=i.array}else{if(1===i.type){if(s=void 0,"string"!==(s=typeof t)&&"number"!==s)throw new ee("The type of key must be string or number but "+typeof t);if("__proto__"===t)throw new ee("The key __proto__ is not allowed");i.key=t,i.type=2;continue e}if(i.map[i.key]=t,i.readCount++,i.readCount!==i.size){i.key=null,i.type=1;continue e}o.pop(),t=i.map}}return t}var s},e.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new ee("Unrecognized array type byte: ".concat(ie(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new ee("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new ee("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:new Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){var n;if(e>this.maxStrLength)throw new ee("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw me;var r,o=this.pos+t;return r=this.stateIsMapKey()&&(null===(n=this.keyDecoder)||void 0===n?void 0:n.canBeCached(e))?this.keyDecoder.decode(this.bytes,o,e):e>Q?function(e,t,n){var r=e.subarray(t,t+n);return G.decode(r)}(this.bytes,o,e):W(this.bytes,o,e),this.pos+=t+e,r},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new ee("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw me;var n=this.pos+t,r=this.bytes.subarray(n,n+e);return this.pos+=t+e,r},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new ee("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,n,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e,t,n=(e=this.view,t=this.pos,4294967296*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,n},e.prototype.readI64=function(){var e=V(this.view,this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},e}(),ge={};const we=(e,t={emitMissingElementWarnings:!0})=>{const n={};e=function(e,t){return void 0===t&&(t=ge),new be(t.extensionCodec,t.context,t.maxStrLength,t.maxBinLength,t.maxArrayLength,t.maxMapLength,t.maxExtLength).decode(e)}(e),e.forEach((e=>{e.batch&&(n[e.batch]=n[e.batch]?++n[e.batch]:1)})),e.forEach((e=>{const r=e.operation;try{if(e.selector?e.xpath?e.element=e.selectAll?p(e.selector):f(e.selector):e.element=e.selectAll?document.querySelectorAll(e.selector):document.querySelector(e.selector):e.element=document,e.element||t.emitMissingElementWarnings){l.set(document.activeElement);const t=q.all[r];t?(t(e),e.batch&&0==--n[e.batch]&&d(document,"cable-ready:batch-complete",{batch:e.batch})):console.error(`CableReady couldn't find the "${r}" operation. Make sure you use the camelized form when calling an operation method.`)}}catch(t){e.element?(console.error(`CableReady detected an error in ${r||"operation"}: ${t.message}. If you need to support older browsers make sure you've included the corresponding polyfills. https://docs.stimulusreflex.com/setup#polyfills-for-ie11.`),console.error(t)):console.warn(`CableReady ${r||"operation"} failed due to missing DOM element for selector: '${e.selector}'`)}}))};let ve;const Ee=[25,50,75,100,200,250,500,800,1e3,2e3],xe=async(e=0)=>{if(ve)return ve;if(e>=Ee.length)throw new Error("Couldn't obtain a Action Cable consumer within 5s");var t;return await(t=Ee[e],new Promise((e=>setTimeout(e,t)))),await xe(e+1)};var Se={setConsumer(e){ve=e},get consumer(){return ve},getConsumer:async()=>await xe()};class Ae extends HTMLElement{static define(){customElements.get("cable-ready")||customElements.define("cable-ready",this)}connectedCallback(){setTimeout((()=>{try{const e=JSON.parse(this.scriptElement.textContent);we(e)}catch(e){console.error(e)}finally{try{this.remove()}catch{}}}))}get scriptElement(){if(this.firstElementChild instanceof HTMLScriptElement&&"application/json"===this.firstElementChild.getAttribute("type"))return this.firstElementChild;throw new Error('First child element in a `<cable-ready>` tag must be `<script type="application/json">`.')}}class Te extends HTMLElement{disconnectedCallback(){this.channel&&this.channel.unsubscribe()}createSubscription(e,t,n){this.channel=e.subscriptions.create({channel:t,identifier:this.identifier},{received:n})}get preview(){return document.documentElement.hasAttribute("data-turbolinks-preview")||document.documentElement.hasAttribute("data-turbo-preview")}get identifier(){return this.getAttribute("identifier")}}class Ue extends Te{static define(){customElements.get("stream-from")||customElements.define("stream-from",this)}async connectedCallback(){if(this.preview)return;const e=await Se.getConsumer();e?this.createSubscription(e,"CableReady::Stream",this.performOperations):console.error("The `stream_from` helper cannot connect without an ActionCable consumer.\nPlease run `rails generate cable_ready:helpers` to fix this.")}performOperations(e){e.cableReady&&we(e.operations)}}class Ce extends Te{static define(){customElements.get("updates-for")||customElements.define("updates-for",this)}constructor(){super();this.attachShadow({mode:"open"}).innerHTML="\n<style>\n  :host {\n    display: block;\n  }\n</style>\n<slot></slot>\n"}async connectedCallback(){if(this.preview)return;this.update=E(this.update.bind(this),this.debounce);const e=await Se.getConsumer();e?this.createSubscription(e,"CableReady::Stream",this.update):console.error("The `updates-for` helper cannot connect without an ActionCable consumer.\nPlease run `rails generate cable_ready:helpers` to fix this.")}async update(e){const t=Array.from(document.querySelectorAll(this.query),(e=>new Le(e)));if(t[0].element!==this)return;l.set(document.activeElement),this.html={};const n=[...new Set(t.map((e=>e.url)))];await Promise.all(n.map((async e=>{if(!this.html.hasOwnProperty(e)){const t=await C(e,{"X-Cable-Ready":"update"});this.html[e]=await t.text()}}))),this.index={},t.forEach((t=>{this.index.hasOwnProperty(t.url)?this.index[t.url]++:this.index[t.url]=0,t.process(e,this.html,this.index)}))}get query(){return`updates-for[identifier="${this.identifier}"]`}get identifier(){return this.getAttribute("identifier")}get debounce(){return this.hasAttribute("debounce")?parseInt(this.getAttribute("debounce")):20}}class Le{constructor(e){this.element=e}async process(e,t,n){if(!this.shouldUpdate(e))return;const o=n[this.url],i=document.createElement("template");this.element.setAttribute("updating","updating"),i.innerHTML=String(t[this.url]).trim(),await this.resolveTurboFrames(i.content);const s=i.content.querySelectorAll(this.query);if(s.length<=o)return void console.warn(`Update aborted due to insufficient number of elements. The offending url is ${this.url}.`);const a={element:this.element,html:s[o],permanentAttributeName:"data-ignore-updates"};d(this.element,"cable-ready:before-update",a),r.default(this.element,s[o],{childrenOnly:!0,onBeforeElUpdated:k(a),onElUpdated:e=>{this.element.removeAttribute("updating"),d(this.element,"cable-ready:after-update",a),h(a.focusSelector)}})}async resolveTurboFrames(e){const t=[...e.querySelectorAll('turbo-frame[src]:not([loading="lazy"])')];return Promise.all(t.map((t=>new Promise((async n=>{const r=await C(t.getAttribute("src"),{"Turbo-Frame":t.id,"X-Cable-Ready":"update"}),o=document.createElement("template");o.innerHTML=await r.text(),await this.resolveTurboFrames(o.content),e.querySelector(`turbo-frame#${t.id}`).innerHTML=String(o.content.querySelector(`turbo-frame#${t.id}`).innerHTML).trim(),n()})))))}shouldUpdate(e){return!this.ignoresInnerUpdates&&this.hasChangesSelectedForUpdate(e)}hasChangesSelectedForUpdate(e){const t=this.element.getAttribute("only");return!(t&&e.changed&&!t.split(" ").some((t=>e.changed.includes(t))))}get ignoresInnerUpdates(){return this.element.hasAttribute("ignore-inner-updates")&&this.element.hasAttribute("performing-inner-update")}get url(){return this.element.hasAttribute("url")?this.element.getAttribute("url"):location.href}get identifier(){return this.element.identifier}get query(){return this.element.query}}const ke=e=>{const t=e&&e.parentElement&&e.parentElement.closest("updates-for");t&&(t.setAttribute("performing-inner-update",""),ke(t))},Me=e=>{const t=e&&e.parentElement&&e.parentElement.closest("updates-for");t&&(t.removeAttribute("performing-inner-update"),Me(t))},Ie={perform:we,performAsync:(e,t={emitMissingElementWarnings:!0})=>new Promise(((n,r)=>{try{n(we(e,t))}catch(e){r(e)}})),shouldMorphCallbacks:P,didMorphCallbacks:B,initialize:(e={})=>{const{consumer:t}=e;document.addEventListener("stimulus-reflex:before",(e=>{ke(e.detail.element)})),document.addEventListener("stimulus-reflex:after",(e=>{setTimeout((()=>{Me(e.detail.element)}))})),document.addEventListener("turbo:submit-start",(e=>{ke(e.target)})),document.addEventListener("turbo:submit-end",(e=>{setTimeout((()=>{Me(e.target)}))})),t?Se.setConsumer(t):console.error("CableReady requires a reference to your Action Cable `consumer` for its helpers to function.\nEnsure that you have imported the `CableReady` package as well as `consumer` from your `channels` folder, then call `CableReady.initialize({ consumer })`."),Ae.define(),Ue.define(),Ce.define()},addOperation:(e,t)=>{const n={};n[e]=t,N(n)},addOperations:e=>{N(e)},version:o,cable:Se,get DOMOperations(){return console.warn("DEPRECATED: Please use `CableReady.operations` instead of `CableReady.DOMOperations`"),q.all},get operations(){return q.all},get consumer(){return Se.consumer}};window.CableReady=Ie,e.CableReadyElement=Ae,e.MorphCallbacks=D,e.StreamFromElement=Ue,e.SubscribingElement=Te,e.UpdatesForElement=Ce,e.Utils=L,e.default=Ie,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=cable_ready.umd.min.js.map
